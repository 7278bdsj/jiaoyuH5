<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title>团购详情</title>
  <link rel="stylesheet" href="./css/reset.css">
  <script src="./js/jquery-2.2.1.min.js"></script>
  <link rel="stylesheet" href="./css/groupBuy.css">
  <link rel="stylesheet" href="./css/swiper-3.4.2.min.css">
</head>
<body>
  <div class="main">
    <div class="top">
      <div class="logo">
        <img src="./images/h5_logo.png" alt="">
      </div>
      <span>
        教育机构
      </span>
      <div class="download">下载</div>
    </div>
    <div class="swiper-container">
      <div class="swiper-wrapper">
          <!-- <div class="swiper-slide">
            <img src="./images/shopping_sku.png" alt="">
          </div>
          <div class="swiper-slide">
            <img src="./images/shopping_sku.png" alt="">
          </div>
          <div class="swiper-slide">
            <img src="./images/shopping_sku.png" alt="">
          </div> -->
      </div>
      <!-- 如果需要分页器 -->
      <div class="swiper-pagination"></div>
  </div>
  <div class="course">
    <div class="course1">
      <div class="left">
        <img src="./images/jg_banner_photo_01.png" alt="">
      </div>
      <div class="right">
        <div class="title">雅思英语阅读提分指南</div>
        <div class="contain">最好的雅思英语阅读课程，名师...</div>
        <div class="number">已售2500</div>
        <div class="price">
          <div class="nowPrice">￥<span>199.0</span></div>
          <div class="oldPrice">&nbsp&nbsp&nbsp&nbsp￥<span>299.0</span><div class="oldLine"></div></div>
        </div>
      </div>
    </div>
    <div class="line"></div>
    <div class="course2">
      服务内容 服务内容 服务内容
    </div>
  </div>
  <div class="group">
    <div class="title">
      <div class="left">拼团列表</div>
      <div class="right">查看更多</div>
    </div>
    <div class="groupItem">
      <div class="avator">
        <img src="./images/jg_banner_photo_01.png" alt="">
      </div>
      <div class="username">
        Aice
      </div>
      <div class="message">
        <div>还差10人拼成</div>
        <div>剩余03:00:00</div>
      </div>
      <div class="btn">去拼团</div>
    </div>
    <div class="groupItem">
      <div class="avator">
        <img src="./images/jg_banner_photo_01.png" alt="">
      </div>
      <div class="username">
        Aice
      </div>
      <div class="message">
        <div>还差10人拼成</div>
        <div>剩余03:00:00</div>
      </div>
      <div class="btn">去拼团</div>
    </div>
  </div>
  <div class="same groupBuy">
    <div class="inTop">
      <h2>团购介绍</h2>
      <span></span>
    </div>
    <div class="bottom">
      查看图文详情
    </div>
  </div>
  <div class="same Course">
    <div class="inTop">
      <h2>课程介绍</h2>
      <span></span>
    </div>
    <div class="bottom">
      查看图文详情
    </div>
  </div>
  <div class="same Buy">
    <div class="inTop">
      <h2>购买须知</h2>
      <span></span>
    </div>
    <div class="bottom">
      查看图文详情
    </div>
  </div>
  <div class="comment">
    <div class="title">用户评价</div>
    <div class="commitItem">
    <div class="user">
      <div class="userAvator">
        <img src="./images/jg_banner_photo_01.png" alt="">
      </div>
      <div class="Uname">
        <div class="UName">PP小丸子</div>
        <div class="grade">评分</div>
      </div>
      <div class="time">2019-06-09</div>
    </div>
    <div class="conContain">
      <span>
    </span>
    <div class="comImg">
      <img src="./images/jg_banner_photo_01.png" alt="">
    </div>
    <div class="comImg">
      <img src="./images/jg_banner_photo_01.png" alt="">
    </div>
    <div class="comImg">
      <img src="./images/jg_banner_photo_01.png" alt="">
    </div>
    </div>
  </div>
  </div>
  <div class="coMore">查看用户所有评价</div>
  <div class="groupBuyBottom">
    <div class="BuyBottom">
      <div class="shouc">
        <div class="BuyBottomImg">
          <img src="./images/shopping_tab_sc_sel.png" alt="">
        </div>
        <span>收藏</span>
      </div>
      <div class="zixun">
        <div class="BuyBottomImg">
          <img src="./images/shopping_tab_icon_consult.png" alt="">
        </div>
        <span>咨询</span>
      </div>
      <div class="share">
        <div class="BuyBottomImg">
          <img src="./images/shopping_tab_share.png" alt="">
        </div>
        <span>分享</span>
      </div>
    </div>
    <div class="addOrder">
      <span class="coPrice"></span><br>
      <span class="coText">发起拼团</span>
    </div>
  </div>
  </div>
<script src="./js/swiper-3.4.2.min.js"></script>
<script>
var url=window.location.href;
// var url="www.********.com/redict?id=7";
var list1=url.split("?")[1].split("&");
var object={};
for(var i=0;i<list1.length;i++){
  var list2=list1[i].split("=");
  object[list2[0]]=list2[1];
}
var id=object.id;
var groupPrice=object.groupPrice;
$.ajax({
  type: "post",
  url: "http://47.107.81.81/jiaoyujigou/api/lesson/detail",
  data: {
    id:id
  },
  dataType: "json",
  success: function (res) {
    var data=res.data;
    var bannerHtml="";
    var serveHtml="";
    var commitHtml="";
    //获取轮播图
    for(var i=0;i<data.imgList.length;i++){
        bannerHtml=bannerHtml+"<div class='swiper-slide'><img src=http://xueyizhi.oss-cn-shenzhen.aliyuncs.com"+data.imgList[i].img+" alt=''></div>"
      }
    $(".swiper-wrapper").html(bannerHtml);
    var mySwiper = new Swiper ('.swiper-container', {
      direction: 'horizontal',
      loop: true,
      autoplay: 5000,
      // 如果需要分页器
      pagination: '.swiper-pagination'
    })
    
    //获取课程信息
    $(".course1 .left img").attr("src","http://xueyizhi.oss-cn-shenzhen.aliyuncs.com"+data.img);
    $(".course1 .right .title").text(data.name);
    $(".course1 .right .contain").text(data.intro);
    $(".course1 .right .number").text("已售"+data.sellCount);
    $(".course1 .right .price .nowPrice span").text(groupPrice);
    $(".course1 .right .price .oldPrice span").text(data.price);

    //获取课程服务的信息
    serveHtml="<span>"+data.serviceContent.content1+"</span>&nbsp&nbsp<span>"+data.serviceContent.content2+"</span>&nbsp&nbsp<span>"+data.serviceContent.content3+"</span>&nbsp&nbsp<span>"+data.serviceContent.content4+"</span>&nbsp&nbsp"
    $(".course2").html(serveHtml);

    //获取团购介绍
    var regex = new RegExp('<img', 'gi');
    if(data.groupDetail!=null){
      var txt = data.groupDetail.replace(regex, '<img style="width: 100%; height:auto"');
    $(".groupBuy .inTop span").html(txt);
    }

    //获取课程介绍
    if(data.detail!=null){
      var  txt2 = data.detail.replace(regex, '<img style="width: 100%; height:auto"');
    $(".Course .inTop span").html(txt2);
    }

    //获取购买须知
    if(data.content!=null){
      var  txt3 = data.content.replace(regex, '<img style="width: 100%; height:auto"');
    $(".Buy .inTop span").html(txt3);
    }

    //获取评论信息
    for(var z=0;z<data.commentList.length;z++){
      var xinNum=data.commentList[z].starNum;
        var xinHtml=""
        for(var k=0;k<5;k++){
          if(k<xinNum){
            xinHtml=xinHtml+"<div class='xinImg'></div>";
          }else{
            xinHtml=xinHtml+"<div class='xinImg2'></div>"
          }
        }
        commitHtml=commitHtml+"<div class='commitItem'><div class='user'><div class='userAvator'><img src=http://xueyizhi.oss-cn-shenzhen.aliyuncs.com"+data.commentList[z].avatar+" alt=''></div><div class='Uname'><div class='UName'>"+data.commentList[z].nick+"</div><div class='grade'><div class='gradeNum'>评分</div><div class='xinxin'>"+xinHtml+"</div></div></div><div class='time'>"+data.commentList[z].createTime+"</div></div><div class='conContain'><span>"+data.commentList[z].content+"</span><div class='comImg'><img src=http://xueyizhi.oss-cn-shenzhen.aliyuncs.com"+data.commentList[z].img1+" alt=''></div><div class='comImg'><img src=http://xueyizhi.oss-cn-shenzhen.aliyuncs.com"+data.commentList[z].img1+" alt=''></div><div class='comImg'><img src=http://xueyizhi.oss-cn-shenzhen.aliyuncs.com"+data.commentList[z].img1+" alt=''></div></div></div>"
      }
    $(".comment").html("<div class='title'>用户评价</div>"+commitHtml);

    //获取是否收藏
    var collect="";
    if(data.isCollect==0){
      $(".shouc .BuyBottomImg img").attr("src","./images/shopping_tab_icon_sc.png");
    }else{
      $(".shouc .BuyBottomImg img").attr("src","./images/shopping_tab_sc_sel.png")
    }

    //修改拼团价格
    $(".coPrice").text("￥"+data.price);
  }
});
//获取团购列表
$.ajax({
  type: "post",
  url: "http://47.107.81.81/jiaoyujigou/api/lesson/groupPage",
  data: {
    id:id,
    pageNumber:1,
    pageSize:3
  },
  dataType: "json",
  success: function (res) {
    var data=res.data;
    var buyGroupHtml="";
    for(var j=0;j<data.list.length;j++){
    var groupTime=(new Date(data.list[j].createTime).getTime()+data.list[j].groupTime)/1000
    // var groupTime=(new Date("2020-08-18 17:40:14").getTime())/1000
    var nowTime=(new Date().getTime())/1000;
    //过期时间差
    var cutTime=(groupTime-nowTime);
    if(cutTime<0){
      cutTime=0;
    }
      buyGroupHtml=buyGroupHtml+"<div class='groupItem'><div class='avator'><img src=http://xueyizhi.oss-cn-shenzhen.aliyuncs.com"+data.list[j].avatar+" alt=''></div><div class='username'>"+data.list[j].nick+"</div><div class='message'><div>还差<span style='color:#00A6FF'>"+data.list[j].num+"</span>人拼成</div><div>剩余"+secondsFormat(cutTime)+"</div></div><div class='btn'>去拼团</div></div>"
    }
    $(".group").html(" <div class='title'><div class='left'>拼团列表</div><div class='right'>查看更多</div></div>"+buyGroupHtml);

  }
});

//时分秒转化
function secondsFormat( s ) { 
    var day = Math.floor( s/ (24*3600) ); // Math.floor()向下取整 
    var hour = Math.floor( (s - day*24*3600) / 3600);
    if(hour<10){
      hour="0"+hour;
    }
    var minute = Math.floor( (s - day*24*3600 - hour*3600) /60 ); 
    if(minute<10){
      minute="0"+minute;
    }
    var second = Math.floor(s - day*24*3600 - hour*3600 - minute*60); 
    if(second<10){
      second="0"+second;
    }
    return  hour+":"+minute+":"+second;
}
</script>
</body>
</html>